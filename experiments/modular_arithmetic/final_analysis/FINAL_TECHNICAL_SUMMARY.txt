GROKKING EXPERIMENTS: FINAL TECHNICAL SUMMARY
================================================================================

EXPERIMENTAL SERIES OVERVIEW
--------------------------------------------------------------------------------
Objective: Investigate grokking phenomenon and attempt to induce delayed
           grokking through output space overlap manipulation

Task: Modular arithmetic (a + b) mod 97 = c
Model: 4-layer transformer (4 heads, 256d, 1024 FF, ~3.2M params)
Training: AdamW optimizer, lr=0.001, weight_decay=0.0, batch_size=256

COMPLETED EXPERIMENTS
--------------------------------------------------------------------------------
V1:   Random 80% split          -> Baseline grokking at ~17k steps
V2:   0% overlap (disjoint)     -> Extrapolation failure (0% at 400k steps)
V3:   49.2% overlap             -> Early interpolation (47.5% at 20k steps)
V3.1: 26.8% overlap             -> Still interpolation (16.4% at 20k steps)
V3.2: 7.8% overlap              -> Boundary regime (7.8% at 20k steps)

KEY OBSERVATIONS
--------------------------------------------------------------------------------
1. Grokking Baseline (V1)
   - Random 80/20 split successfully demonstrates grokking
   - Sharp accuracy transition at t_grok = 17,100 steps
   - Representation rank collapse: 5 -> 1 (accompanies generalization)
   - Attention entropy decrease during transition
   - Final accuracy: 99.36%

2. Extrapolation Failure (V2)
   - Disjoint output ranges: Train [0,47], Test [48,96]
   - Zero overlap prevents any generalization
   - Model remains at 0% test accuracy through 400k steps
   - No rank collapse observed
   - Conclusion: Pure extrapolation is impossible for this task/model

3. Interpolation Regime (V3, V3.1)
   - Large overlap (27-49%) allows easy interpolation
   - Test accuracy exceeds sanity threshold (5%) within 20k steps
   - V3 (49%): 47.5% accuracy (9.5x over threshold)
   - V3.1 (27%): 16.4% accuracy (3.3x over threshold)
   - No delayed grokking observed
   - Conclusion: High overlap eliminates constraint conflict

4. Boundary Regime (V3.2)
   - Minimal overlap (7.8%) creates strongest constraint conflict
   - Test accuracy: 7.8% at 20k steps (1.6x over threshold)
   - Closest approach to delayed grokking criterion (5%)
   - Still exceeds threshold but significantly better than V3/V3.1
   - Represents practical lower bound of viable overlap

5. Phase Transition Pattern
   - Clear monotonic relationship: overlap% -> test_accuracy
   - V2 (0%) -> 0.0% : Extrapolation impossible
   - V3.2 (7.8%) -> 7.8% : Boundary regime (closest to criterion)
   - V3.1 (27%) -> 16.4% : Interpolation begins
   - V3 (49%) -> 47.5% : Easy interpolation
   - V1 (Random ~80%) -> 35% @ 20k : Full interpolation capability

REPRESENTATION DYNAMICS
--------------------------------------------------------------------------------
V1 (Successful Grokking):
  - Initial rank: ~5
  - Final rank: ~1
  - Sharp collapse at t_grok
  - Collapse coincides with generalization

V3.2 (Boundary Regime):
  - Initial rank: ~30-40
  - Final rank: ~30-40 (no collapse at 20k)
  - Rank remains high throughout
  - No grokking transition observed

Conclusion: Rank collapse is a reliable signature of grokking. Its absence
            in V3.2 confirms that delayed grokking did not occur within 20k.

MAIN CONCLUSION
--------------------------------------------------------------------------------
Grokking via output overlap manipulation faces fundamental constraints:

1. NARROW VIABLE REGIME
   - Grokking requires interpolation capability (overlap > 0%)
   - But excessive overlap eliminates constraint conflict (overlap > 27%)
   - Viable regime: 0% < overlap < 27%
   - Actual observed range: Very narrow, possibly < 7.8%

2. BOUNDARY CHARACTERISTICS
   - V3.2 (7.8% overlap) represents practical lower bound
   - Achieved 7.8% test accuracy (closest to 5% criterion)
   - Further reduction risks approaching V2's extrapolation failure
   - Trade-off: Lower overlap delays learning but risks making task impossible

3. PHASE TRANSITION BEHAVIOR
   - System exhibits sharp transition between regimes:
     * Extrapolation failure (0% overlap)
     * Boundary regime (7.8% overlap)
     * Interpolation regime (>27% overlap)
   - No smooth "delayed grokking" regime identified
   - Model either interpolates easily or fails to generalize

4. TASK/MODEL LIMITATIONS
   - For modular arithmetic with 4-layer transformer:
     * Random splits enable grokking (V1 success)
     * Structured overlap manipulation is insufficient
     * Constraint conflict alone does not guarantee delayed grokking
   - Other task/model combinations may exhibit different boundaries

IMPLICATIONS
--------------------------------------------------------------------------------
- Grokking is not easily controlled via simple data split manipulation
- Overlap-based constraint conflict creates continuous difficulty gradient
- But gradient does not translate to "delayed grokking" within viable range
- Successful grokking (V1) vs boundary behavior (V3.2) suggests that:
  * Random splits preserve essential algorithmic structure
  * Structured splits disrupt this structure even with minimal overlap

EXPERIMENTAL ARTIFACTS
--------------------------------------------------------------------------------
Generated outputs:
  - final_accuracy_comparison.png
  - final_rank_comparison.png
  - final_overlap_phase_diagram.png
  - FINAL_TECHNICAL_SUMMARY.txt

Preserved experiment directories:
  - experiments/modular_arithmetic/v1_baseline/
  - experiments/modular_arithmetic/v2/
  - experiments/modular_arithmetic/v3_overlap_conflict/
  - experiments/modular_arithmetic/v3_1_reduced_overlap/
  - experiments/modular_arithmetic/v3_2_minimal_overlap/

================================================================================
Experiments concluded. No further training required.
================================================================================
